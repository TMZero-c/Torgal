<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
</head>
<body>
    <h1>Hello World!</h1>
    <p>
        We are using Node.js <span id="node-version"></span>,
        Chromium <span id="chrome-version"></span>,
        and Electron <span id="electron-version"></span>.
    </p>
</body>
<button id="mic-btn">Start Recording</button>
<p id="status"></p>
<div id="output"></div>

<script>
  let mediaRecorder;
  let audioChunks = [];
  const btn = document.getElementById('mic-btn');

  btn.onclick = async () => {
    if (mediaRecorder?.state === "recording") {
      mediaRecorder.stop();
      btn.innerText = "Start Recording";
    } else {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
      
      mediaRecorder.onstop = async () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
        const arrayBuffer = await audioBlob.arrayBuffer();
        
        // Send the buffer to the Main Process via IPC
        window.electronAPI.sendAudio(arrayBuffer);
        document.getElementById('status').innerText = "Transcribing...";
      };

      mediaRecorder.start();
      btn.innerText = "Stop & Transcribe";
    }
  };
</script>
</html>